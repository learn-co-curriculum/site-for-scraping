!function(t){var e=this.SelectBox=function(t,e){if(t instanceof jQuery){if(!(t.length>0))return;t=t[0]}return this.typeTimer=null,this.typeSearch="",this.isMac=navigator.platform.match(/mac/i),e="object"==typeof e?e:{},this.selectElement=t,!e.mobile&&navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i)?!1:"select"!==t.tagName.toLowerCase()?!1:void this.init(e)};e.prototype.version="1.2.0",e.prototype.init=function(e){var n=t(this.selectElement);if(n.data("selectBox-control"))return!1;var i=t('<a class="selectBox" />'),o=n.attr("multiple")||parseInt(n.attr("size"))>1,r=e||{},s=parseInt(n.prop("tabindex"))||0,a=this;if(i.width(n.outerWidth()).addClass(n.attr("class")).attr("title",n.attr("title")||"").attr("tabindex",s).css("display","inline-block").bind("focus.selectBox",function(){this!==document.activeElement&&document.body!==document.activeElement&&t(document.activeElement).blur(),i.hasClass("selectBox-active")||(i.addClass("selectBox-active"),n.trigger("focus"))}).bind("blur.selectBox",function(){i.hasClass("selectBox-active")&&(i.removeClass("selectBox-active"),n.trigger("blur"))}),t(window).data("selectBox-bindings")||t(window).data("selectBox-bindings",!0).bind("scroll.selectBox",this.hideMenus).bind("resize.selectBox",this.hideMenus),n.attr("disabled")&&i.addClass("selectBox-disabled"),n.bind("click.selectBox",function(t){i.focus(),t.preventDefault()}),o){if(e=this.getOptions("inline"),i.append(e).data("selectBox-options",e).addClass("selectBox-inline selectBox-menuShowing").bind("keydown.selectBox",function(t){a.handleKeyDown(t)}).bind("keypress.selectBox",function(t){a.handleKeyPress(t)}).bind("mousedown.selectBox",function(e){1===e.which&&(t(e.target).is("A.selectBox-inline")&&e.preventDefault(),i.hasClass("selectBox-focus")||i.focus())}).insertAfter(n),!n[0].style.height){var l=n.attr("size")?parseInt(n.attr("size")):5,c=i.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");c.find(".selectBox-options").html("<li><a>\xa0</a></li>");var u=parseInt(c.find(".selectBox-options A:first").html("&nbsp;").outerHeight());c.remove(),i.height(u*l)}this.disableSelection(i)}else{var h=t('<span class="selectBox-label" />'),p=t('<span class="selectBox-arrow" />');h.attr("class",this.getLabelClass()).text(this.getLabelText()),e=this.getOptions("dropdown"),e.appendTo("BODY"),i.data("selectBox-options",e).addClass("selectBox-dropdown").append(h).append(p).bind("mousedown.selectBox",function(t){1===t.which&&(i.hasClass("selectBox-menuShowing")?a.hideMenus():(t.stopPropagation(),e.data("selectBox-down-at-x",t.screenX).data("selectBox-down-at-y",t.screenY),a.showMenu()))}).bind("keydown.selectBox",function(t){a.handleKeyDown(t)}).bind("keypress.selectBox",function(t){a.handleKeyPress(t)}).bind("open.selectBox",function(t,e){e&&e._selectBox===!0||a.showMenu()}).bind("close.selectBox",function(t,e){e&&e._selectBox===!0||a.hideMenus()}).insertAfter(n);var d=i.width()-p.outerWidth()-parseInt(h.css("paddingLeft"))||0-parseInt(h.css("paddingRight"))||0;h.width(d),this.disableSelection(i)}n.addClass("selectBox").data("selectBox-control",i).data("selectBox-settings",r).hide()},e.prototype.getOptions=function(e){var n,i=t(this.selectElement),o=this,r=function(e,n){return e.children("OPTION, OPTGROUP").each(function(){if(t(this).is("OPTION"))t(this).length>0?o.generateOptions(t(this),n):n.append("<li>\xa0</li>");else{var e=t('<li class="selectBox-optgroup" />');e.text(t(this).attr("label")),n.append(e),n=r(t(this),n)}}),n};switch(e){case"inline":return n=t('<ul class="selectBox-options" />'),n=r(i,n),n.find("A").bind("mouseover.selectBox",function(){o.addHover(t(this).parent())}).bind("mouseout.selectBox",function(){o.removeHover(t(this).parent())}).bind("mousedown.selectBox",function(t){1===t.which&&(t.preventDefault(),i.selectBox("control").hasClass("selectBox-active")||i.selectBox("control").focus())}).bind("mouseup.selectBox",function(e){1===e.which&&(o.hideMenus(),o.selectOption(t(this).parent(),e))}),this.disableSelection(n),n;case"dropdown":n=t('<ul class="selectBox-dropdown-menu selectBox-options" />'),n=r(i,n),n.data("selectBox-select",i).css("display","none").appendTo("BODY").find("A").bind("mousedown.selectBox",function(t){1===t.which&&(t.preventDefault(),t.screenX===n.data("selectBox-down-at-x")&&t.screenY===n.data("selectBox-down-at-y")&&(n.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),o.hideMenus()))}).bind("mouseup.selectBox",function(e){1===e.which&&(e.screenX!==n.data("selectBox-down-at-x")||e.screenY!==n.data("selectBox-down-at-y"))&&(n.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),o.selectOption(t(this).parent()),o.hideMenus())}).bind("mouseover.selectBox",function(){o.addHover(t(this).parent())}).bind("mouseout.selectBox",function(){o.removeHover(t(this).parent())});var s=i.attr("class")||"";if(""!==s){s=s.split(" ");for(var a in s)n.addClass(s[a]+"-selectBox-dropdown-menu")}return this.disableSelection(n),n}},e.prototype.getLabelClass=function(){var e=t(this.selectElement).find("OPTION:selected");return("selectBox-label "+(e.attr("class")||"")).replace(/\s+$/,"")},e.prototype.getLabelText=function(){var e=t(this.selectElement).find("OPTION:selected");return e.text()||"\xa0"},e.prototype.setLabel=function(){var e=t(this.selectElement),n=e.data("selectBox-control");n&&n.find(".selectBox-label").attr("class",this.getLabelClass()).text(this.getLabelText())},e.prototype.destroy=function(){var e=t(this.selectElement),n=e.data("selectBox-control");if(n){var i=n.data("selectBox-options");i.remove(),n.remove(),e.removeClass("selectBox").removeData("selectBox-control").data("selectBox-control",null).removeData("selectBox-settings").data("selectBox-settings",null).show()}},e.prototype.refresh=function(){var e=t(this.selectElement),n=e.data("selectBox-control"),i=n.hasClass("selectBox-dropdown"),o=n.hasClass("selectBox-menuShowing");e.selectBox("options",e.html()),i&&o&&this.showMenu()},e.prototype.showMenu=function(){var e=this,n=t(this.selectElement),i=n.data("selectBox-control"),o=n.data("selectBox-settings"),r=i.data("selectBox-options");if(i.hasClass("selectBox-disabled"))return!1;this.hideMenus();var s=parseInt(i.css("borderBottomWidth"))||0;if(r.width(i.innerWidth()).css({top:i.offset().top+i.outerHeight()-s,left:i.offset().left}),n.triggerHandler("beforeopen"))return!1;var a=function(){n.triggerHandler("open",{_selectBox:!0})};switch(o.menuTransition){case"fade":r.fadeIn(o.menuSpeed,a);break;case"slide":r.slideDown(o.menuSpeed,a);break;default:r.show(o.menuSpeed,a)}o.menuSpeed||a();var l=r.find(".selectBox-selected:first");this.keepOptionInView(l,!0),this.addHover(l),i.addClass("selectBox-menuShowing"),t(document).bind("mousedown.selectBox",function(n){if(1===n.which){if(t(n.target).parents().andSelf().hasClass("selectBox-options"))return;e.hideMenus()}})},e.prototype.hideMenus=function(){0!==t(".selectBox-dropdown-menu:visible").length&&(t(document).unbind("mousedown.selectBox"),t(".selectBox-dropdown-menu").each(function(){var e=t(this),n=e.data("selectBox-select"),i=n.data("selectBox-control"),o=n.data("selectBox-settings");if(n.triggerHandler("beforeclose"))return!1;var r=function(){n.triggerHandler("close",{_selectBox:!0})};if(o){switch(o.menuTransition){case"fade":e.fadeOut(o.menuSpeed,r);break;case"slide":e.slideUp(o.menuSpeed,r);break;default:e.hide(o.menuSpeed,r)}o.menuSpeed||r(),i.removeClass("selectBox-menuShowing")}else t(this).hide(),t(this).triggerHandler("close",{_selectBox:!0}),t(this).removeClass("selectBox-menuShowing")}))},e.prototype.selectOption=function(e,n){var i=t(this.selectElement);e=t(e);{var o=i.data("selectBox-control");i.data("selectBox-settings")}if(o.hasClass("selectBox-disabled"))return!1;if(0===e.length||e.hasClass("selectBox-disabled"))return!1;if(i.attr("multiple"))if(n.shiftKey&&o.data("selectBox-last-selected")){e.toggleClass("selectBox-selected");var r;r=e.index()>o.data("selectBox-last-selected").index()?e.siblings().slice(o.data("selectBox-last-selected").index(),e.index()):e.siblings().slice(e.index(),o.data("selectBox-last-selected").index()),r=r.not(".selectBox-optgroup, .selectBox-disabled"),e.hasClass("selectBox-selected")?r.addClass("selectBox-selected"):r.removeClass("selectBox-selected")}else this.isMac&&n.metaKey||!this.isMac&&n.ctrlKey?e.toggleClass("selectBox-selected"):(e.siblings().removeClass("selectBox-selected"),e.addClass("selectBox-selected"));else e.siblings().removeClass("selectBox-selected"),e.addClass("selectBox-selected");o.hasClass("selectBox-dropdown")&&o.find(".selectBox-label").text(e.text());var s=0,a=[];return i.attr("multiple")?o.find(".selectBox-selected A").each(function(){a[s++]=t(this).attr("rel")}):a=e.find("A").attr("rel"),o.data("selectBox-last-selected",e),i.val()!==a&&(i.val(a),this.setLabel(),i.trigger("change")),!0},e.prototype.addHover=function(e){e=t(e);var n=t(this.selectElement),i=n.data("selectBox-control"),o=i.data("selectBox-options");o.find(".selectBox-hover").removeClass("selectBox-hover"),e.addClass("selectBox-hover")},e.prototype.getSelectElement=function(){return this.selectElement},e.prototype.removeHover=function(e){e=t(e);var n=t(this.selectElement),i=n.data("selectBox-control"),o=i.data("selectBox-options");o.find(".selectBox-hover").removeClass("selectBox-hover")},e.prototype.keepOptionInView=function(e,n){if(e&&0!==e.length){var i=t(this.selectElement),o=i.data("selectBox-control"),r=o.data("selectBox-options"),s=o.hasClass("selectBox-dropdown")?r:r.parent(),a=parseInt(e.offset().top-s.position().top),l=parseInt(a+e.outerHeight());n?s.scrollTop(e.offset().top-s.offset().top+s.scrollTop()-s.height()/2):(0>a&&s.scrollTop(e.offset().top-s.offset().top+s.scrollTop()),l>s.height()&&s.scrollTop(e.offset().top+e.outerHeight()-s.offset().top+s.scrollTop()-s.height()))}},e.prototype.handleKeyDown=function(e){var n=t(this.selectElement),i=n.data("selectBox-control"),o=i.data("selectBox-options"),r=n.data("selectBox-settings"),s=0,a=0;if(!i.hasClass("selectBox-disabled"))switch(e.keyCode){case 8:e.preventDefault(),this.typeSearch="";break;case 9:case 27:this.hideMenus(),this.removeHover();break;case 13:i.hasClass("selectBox-menuShowing")?(this.selectOption(o.find("LI.selectBox-hover:first"),e),i.hasClass("selectBox-dropdown")&&this.hideMenus()):this.showMenu();break;case 38:case 37:if(e.preventDefault(),i.hasClass("selectBox-menuShowing")){var l=o.find(".selectBox-hover").prev("LI");for(s=o.find("LI:not(.selectBox-optgroup)").length,a=0;(0===l.length||l.hasClass("selectBox-disabled")||l.hasClass("selectBox-optgroup"))&&(l=l.prev("LI"),0===l.length&&(l=o.find(r.loopOptions?"LI:last":"LI:first")),!(++a>=s)););this.addHover(l),this.selectOption(l,e),this.keepOptionInView(l)}else this.showMenu();break;case 40:case 39:if(e.preventDefault(),i.hasClass("selectBox-menuShowing")){var c=o.find(".selectBox-hover").next("LI");for(s=o.find("LI:not(.selectBox-optgroup)").length,a=0;(0===c.length||c.hasClass("selectBox-disabled")||c.hasClass("selectBox-optgroup"))&&(c=c.next("LI"),0===c.length&&(c=o.find(r.loopOptions?"LI:first":"LI:last")),!(++a>=s)););this.addHover(c),this.selectOption(c,e),this.keepOptionInView(c)}else this.showMenu()}},e.prototype.handleKeyPress=function(e){var n=t(this.selectElement),i=n.data("selectBox-control"),o=i.data("selectBox-options");if(!i.hasClass("selectBox-disabled"))switch(e.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:i.hasClass("selectBox-menuShowing")||this.showMenu(),e.preventDefault(),clearTimeout(this.typeTimer),this.typeSearch+=String.fromCharCode(e.charCode||e.keyCode),o.find("A").each(function(){return t(this).text().substr(0,this.typeSearch.length).toLowerCase()===this.typeSearch.toLowerCase()?(this.addHover(t(this).parent()),this.selectOption(t(this).parent(),e),this.keepOptionInView(t(this).parent()),!1):void 0}),this.typeTimer=setTimeout(function(){this.typeSearch=""},1e3)}},e.prototype.enable=function(){var e=t(this.selectElement);e.prop("disabled",!1);var n=e.data("selectBox-control");n&&n.removeClass("selectBox-disabled")},e.prototype.disable=function(){var e=t(this.selectElement);e.prop("disabled",!0);var n=e.data("selectBox-control");n&&n.addClass("selectBox-disabled")},e.prototype.setValue=function(e){var n=t(this.selectElement);n.val(e),e=n.val(),null===e&&(e=n.children().first().val(),n.val(e));var i=n.data("selectBox-control");if(i){var o=n.data("selectBox-settings"),r=i.data("selectBox-options");this.setLabel(),r.find(".selectBox-selected").removeClass("selectBox-selected"),r.find("A").each(function(){if("object"==typeof e)for(var n=0;n<e.length;n++)t(this).attr("rel")==e[n]&&t(this).parent().addClass("selectBox-selected");else t(this).attr("rel")==e&&t(this).parent().addClass("selectBox-selected")}),o.change&&o.change.call(n)}},e.prototype.setOptions=function(e){{var n,i=t(this.selectElement),o=i.data("selectBox-control");i.data("selectBox-settings")}switch(typeof e){case"string":i.html(e);break;case"object":i.html("");for(var r in e)if(null!==e[r])if("object"==typeof e[r]){var s=t('<optgroup label="'+r+'" />');for(var a in e[r])s.append('<option value="'+a+'">'+e[r][a]+"</option>");i.append(s)}else{var l=t('<option value="'+r+'">'+e[r]+"</option>");i.append(l)}}if(o)switch(o.data("selectBox-options").remove(),n=o.hasClass("selectBox-dropdown")?"dropdown":"inline",e=this.getOptions(n),o.data("selectBox-options",e),n){case"inline":o.append(e);break;case"dropdown":this.setLabel(),t("BODY").append(e)}},e.prototype.disableSelection=function(e){t(e).css("MozUserSelect","none").bind("selectstart",function(t){t.preventDefault()})},e.prototype.generateOptions=function(e,n){var i=t("<li />"),o=t("<a />");i.addClass(e.attr("class")),i.data(e.data()),o.attr("rel",e.val()).text(e.text()),i.append(o),e.attr("disabled")&&i.addClass("selectBox-disabled"),e.attr("selected")&&i.addClass("selectBox-selected"),n.append(i)},t.extend(t.fn,{selectBox:function(n,i){var o;switch(n){case"control":return t(this).data("selectBox-control");case"settings":if(!i)return t(this).data("selectBox-settings");t(this).each(function(){t(this).data("selectBox-settings",t.extend(!0,t(this).data("selectBox-settings"),i))});break;case"options":if(void 0===i)return t(this).data("selectBox-control").data("selectBox-options");t(this).each(function(){(o=t(this).data("selectBox"))&&o.setOptions(i)});break;case"value":if(void 0===i)return t(this).val();t(this).each(function(){(o=t(this).data("selectBox"))&&o.setValue(i)});break;case"refresh":t(this).each(function(){(o=t(this).data("selectBox"))&&o.refresh()});break;case"enable":t(this).each(function(){(o=t(this).data("selectBox"))&&o.enable(this)});break;case"disable":t(this).each(function(){(o=t(this).data("selectBox"))&&o.disable()});break;case"destroy":t(this).each(function(){(o=t(this).data("selectBox"))&&(o.destroy(),t(this).data("selectBox",null))});break;case"instance":return t(this).data("selectBox");default:t(this).each(function(i,o){t(o).data("selectBox")||t(o).data("selectBox",new e(o,n))})}return t(this)}})}(jQuery);